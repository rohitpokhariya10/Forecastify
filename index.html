<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forecastify </title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Merriweather+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <style>
       
        body {
            margin: 0;
            padding: 0;
            background-image: linear-gradient(160deg, #112d4e 0%, #3f72af 100%);
            min-height: 100vh;
            overflow-x: hidden;

        }

        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Merriweather Sans', sans-serif;
        }

        :root {
            --colorDark1: #112D4E;
            --colorDark2: #3F72AF;
            --colorLight1: #DBE2EF;
            --colorLight2: #F9F7F7;
        }

        .wrapper {
            width: 100vw;
            min-height: 100vh;
            color: var(--colorLight2);
            background-image: linear-gradient(160deg, #112d4e 0%, #3f72af 100%);
            transition: background-image 0.5s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            text-align: center;
            text-transform: uppercase;
            padding-top: 20px;
            font-size: 2rem;
        }

        .tab-container {
            width: 90%;
            max-width: 550px;
            margin: 0 auto;
            margin-top: 2rem;
            display: flex;
            justify-content: space-between;
        }

        .tab {
            cursor: pointer;
            font-size: 0.875rem;
            letter-spacing: 1.75px;
            padding: 8px 15px;
            transition: background-color 0.3s;
        }

        .tab.current-tab {
            background-color: rgba(219, 226, 239, 0.5);
            border-radius: 4px;
        }

        .weather-container {
            margin-block: 4rem;
        }

        .btn {
            all: unset;
            font-size: 0.85rem;
            text-transform: uppercase;
            border-radius: 5px;
            background-color: var(--colorDark2);
            cursor: pointer;
            padding: 10px 30px;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background-color: #2a5d9b;
        }

        .sub-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .grant-location-container, .loading-container, .user-info-container, .form-container, .forecast-container {
            display: none;
        }

        .grant-location-container.active, .loading-container.active, .user-info-container.active, .form-container.active, .forecast-container.active {
            display: flex;
        }

        .grant-location-container img {
            margin-bottom: 2rem;
        }

        .grant-location-container p:first-of-type {
            font-size: 1.75rem;
            font-weight: 600;
        }

        .grant-location-container p:last-of-type {
            font-size: 0.85rem;
            font-weight: 500;
            margin-top: 0.75rem;
            margin-bottom: 1.75rem;
            letter-spacing: 0.75px;
        }

        .loading-container p {
            text-transform: uppercase;
        }

        .form-container {
            width: 90%;
            max-width: 550px;
            margin: 0 auto;
            gap: 10px;
            margin-bottom: 3rem;
        }

        .form-container input {
            all: unset;
            width: calc(100% - 80px);
            height: 40px;
            padding: 0 20px;
            background-color: rgba(219, 226, 239, 0.5);
            border-radius: 10px;
        }

        .form-container input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .form-container input:focus {
            outline: 3px solid rgba(255, 255, 255, 0.7);
        }

        .form-container .btn {
            padding: unset;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 100%;
        }

        .user-info-container p {
            font-size: 1.5rem;
            font-weight: 200;
        }

        .name {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .name p {
            font-size: 2rem;
        }

        .name img {
            width: 30px;
            height: 30px;
        }

        .user-info-container p[data-temp] {
            font-size: 2.75rem;
            font-weight: 700;
        }

        .unit-toggle {
            margin-top: 1rem;
            font-size: 0.9rem;
            cursor: pointer;
            color: var(--colorLight1);
        }

        .unit-toggle:hover {
            color: #fff;
        }

        .parameter-container {
            width: 90%;
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 2rem;
        }

        .parameter {
            width: 30%;
            max-width: 200px;
            background-color: rgba(219, 226, 239, 0.5);
            border-radius: 5px;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .parameter img {
            width: 50px;
            height: 50px;
        }

        .parameter p:first-of-type {
            font-size: 1.15rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .parameter p:last-of-type {
            font-size: 1rem;
            font-weight: 200;
        }

        .forecast-container {
            width: 90%;
            max-width: 600px;
            margin: 2rem auto;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }

        .forecast-card {
            background-color: rgba(219, 226, 239, 0.5);
            border-radius: 5px;
            padding: 10px;
            width: 120px;
            text-align: center;
        }

        .forecast-card img {
            width: 40px;
            height: 40px;
        }

        .error-message {
            display: none;
            color: #ff6b6b;
            font-size: 1.2rem;
            text-align: center;
            margin-top: 2rem;
        }

        .error-message.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="wrapper">
        <h1>Weather App</h1>
        <div class="tab-container">
            <p class="tab" data-userWeather>Your Weather</p>
            <p class="tab" data-searchWeather>Search Weather</p>
        </div>
        <div class="weather-container">
            <div class="sub-container grant-location-container">
                <img src="location.png" width="80" height="80" loading="lazy">
                <p>Grant Location Access</p>
                <p>Allow Access to get weather Information</p>
                <button class="btn" data-grantAccess>Grant Access</button>
            </div>
            <form class="form-container" data-searchForm>
                <input placeholder="Search for City..." data-searchInput>
                <button class="btn" type="submit">
                    <img src="search.png" width="20" height="20" loading="lazy">
                </button>
            </form>
            <div class="sub-container loading-container">
                <img src="loading.gif" width="150" height="150">
                <p>Loading</p>
            </div>
            <div class="sub-container user-info-container">
                <div class="name">
                    <p data-cityName></p>
                    <img data-countryIcon>
                </div>
                <p data-localTime></p>
                <p data-weatherDesc></p>
                <img data-weatherIcon>
                <p data-temp></p>
                <p class="unit-toggle" data-unitToggle>Switch to °F</p>
                <div class="parameter-container">
                    <div class="parameter">
                        <img src="wind.png">
                        <p>Windspeed</p>
                        <p data-windspeed></p>
                    </div>
                    <div class="parameter">
                        <img src="humidity.png">
                        <p>Humidity</p>
                        <p data-humidity></p>
                    </div>
                    <div class="parameter">
                        <img src="cloud.png">
                        <p>Clouds</p>
                        <p data-cloudiness></p>
                    </div>
                </div>
            </div>
            <div class="forecast-container" data-forecast></div>
            <p class="error-message" data-error></p>
        </div>
    </div>
    <script>
        const userTab = document.querySelector("[data-userWeather]");
        const searchTab = document.querySelector("[data-searchWeather]");
        const grantAccessContainer = document.querySelector(".grant-location-container");
        const searchForm = document.querySelector("[data-searchForm]");
        const loadingScreen = document.querySelector(".loading-container");
        const userInfoContainer = document.querySelector(".user-info-container");
        const forecastContainer = document.querySelector("[data-forecast]");
        const errorMessage = document.querySelector("[data-error]");
        const wrapper = document.querySelector(".wrapper");

        let currentTab = userTab;
        const API_KEY = "d1845658f92b31c64bd94f06f7188c9c"; // Replace with your API key
        let isCelsius = true;

        currentTab.classList.add("current-tab");
        getFromSessionStorage();

        function switchTab(newTab) {
            if (newTab !== currentTab) {
                currentTab.classList.remove("current-tab");
                currentTab = newTab;
                currentTab.classList.add("current-tab");

                if (!searchForm.classList.contains("active")) {
                    userInfoContainer.classList.remove("active");
                    grantAccessContainer.classList.remove("active");
                    searchForm.classList.add("active");
                    forecastContainer.classList.remove("active");
                    errorMessage.classList.remove("active");
                } else {
                    searchForm.classList.remove("active");
                    userInfoContainer.classList.remove("active");
                    forecastContainer.classList.remove("active");
                    errorMessage.classList.remove("active");
                    getFromSessionStorage();
                }
            }
        }

        userTab.addEventListener("click", () => switchTab(userTab));
        searchTab.addEventListener("click", () => switchTab(searchTab));

        function getFromSessionStorage() {
            const localCoordinates = sessionStorage.getItem("user-coordinates");
            if (!localCoordinates) {
                grantAccessContainer.classList.add("active");
            } else {
                const coordinates = JSON.parse(localCoordinates);
                fetchUserWeatherInfo(coordinates);
            }
        }

        async function fetchUserWeatherInfo(coordinates) {
            const { lat, lon } = coordinates;
            grantAccessContainer.classList.remove("active");
            loadingScreen.classList.add("active");
            errorMessage.classList.remove("active");

            try {
                const response = await fetch(
                    `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric`
                );
                const data = await response.json();

                if (!response.ok) throw new Error(data.message || "Failed to fetch weather data");

                loadingScreen.classList.remove("active");
                userInfoContainer.classList.add("active");
                renderWeatherInfo(data);
                fetchForecast(lat, lon);
            } catch (err) {
                loadingScreen.classList.remove("active");
                errorMessage.textContent = err.message;
                errorMessage.classList.add("active");
                console.error("Error fetching weather:", err);
            }
        }

        async function fetchSearchWeatherInfo(city) {
            loadingScreen.classList.add("active");
            userInfoContainer.classList.remove("active");
            grantAccessContainer.classList.remove("active");
            forecastContainer.classList.remove("active");
            errorMessage.classList.remove("active");

            try {
                const response = await fetch(
                    `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${API_KEY}&units=metric`
                );
                const data = await response.json();

                if (!response.ok) throw new Error(data.message || "City not found");

                loadingScreen.classList.remove("active");
                userInfoContainer.classList.add("active");
                renderWeatherInfo(data);
                const { coord } = data;
                fetchForecast(coord.lat, coord.lon);
            } catch (err) {
                loadingScreen.classList.remove("active");
                errorMessage.textContent = err.message;
                errorMessage.classList.add("active");
                console.error("Error fetching search weather:", err);
            }
        }

        async function fetchForecast(lat, lon) {
            try {
                const response = await fetch(
                    `https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric`
                );
                const data = await response.json();
                if (!response.ok) throw new Error(data.message || "Failed to fetch forecast");
                renderForecast(data);
            } catch (err) {
                console.error("Error fetching forecast:", err);
            }
        }
        function renderWeatherInfo(weatherInfo) {
    const cityName = document.querySelector("[data-cityName]");
    const countryIcon = document.querySelector("[data-countryIcon]");
    const localTime = document.querySelector("[data-localTime]");
    const desc = document.querySelector("[data-weatherDesc]");
    const weatherIcon = document.querySelector("[data-weatherIcon]");
    const temp = document.querySelector("[data-temp]");
    const windspeed = document.querySelector("[data-windspeed]");
    const humidity = document.querySelector("[data-humidity]");
    const cloudiness = document.querySelector("[data-cloudiness]");
    const unitToggle = document.querySelector("[data-unitToggle]");

    cityName.innerText = weatherInfo?.name || "Unknown";
    countryIcon.src = weatherInfo?.sys?.country
        ? `https://flagcdn.com/144x108/${weatherInfo.sys.country.toLowerCase()}.png`
        : "";

    // India ke liye local time logic
    if (weatherInfo?.sys?.country === "IN") {
        // Directly use current time for India to avoid stale API data
        const indiaTime = new Date();
        localTime.innerText = `Local Time (IST): ${indiaTime.toLocaleTimeString('en-IN', { timeZone: 'Asia/Kolkata' })}`;
    } else {
        // Non-India locations ke liye API ka timezone use karo
        localTime.innerText = weatherInfo?.dt
            ? `Local Time: ${new Date(weatherInfo.dt * 1000 + weatherInfo.timezone * 1000).toLocaleTimeString()}`
            : `Local Time: ${new Date().toLocaleTimeString()}`;
    }

    desc.innerText = weatherInfo?.weather?.[0]?.description || "N/A";
    weatherIcon.src = weatherInfo?.weather?.[0]?.icon
        ? `http://openweathermap.org/img/wn/${weatherInfo.weather[0].icon}@2x.png`
        : "";
    temp.innerText = isCelsius
        ? `${weatherInfo?.main?.temp || 0} °C`
        : `${((weatherInfo?.main?.temp || 0) * 9/5 + 32).toFixed(1)} °F`;
    windspeed.innerText = `${weatherInfo?.wind?.speed || 0} m/s`;
    humidity.innerText = `${weatherInfo?.main?.humidity || 0}%`;
    cloudiness.innerText = `${weatherInfo?.clouds?.all || 0}%`;

    unitToggle.innerText = isCelsius ? "Switch to °F" : "Switch to °C";
    unitToggle.onclick = () => {
        isCelsius = !isCelsius;
        renderWeatherInfo(weatherInfo);
    };

    const weatherMain = weatherInfo?.weather?.[0]?.main?.toLowerCase();
    if (weatherMain?.includes("clear")) {
        document.body.style.backgroundImage = "linear-gradient(160deg, #ffeb3b, #ff9800)";
        wrapper.style.backgroundImage = "linear-gradient(160deg, #ffeb3b, #ff9800)";
    } else if (weatherMain?.includes("cloud")) {
        document.body.style.backgroundImage = "linear-gradient(160deg, #607d8b, #b0bec5)";
        wrapper.style.backgroundImage = "linear-gradient(160deg, #607d8b, #b0bec5)";
    } else if (weatherMain?.includes("rain") || weatherMain?.includes("drizzle")) {
        document.body.style.backgroundImage = "linear-gradient(160deg, #0288d1, #01579b)";
        wrapper.style.backgroundImage = "linear-gradient(160deg, #0288d1, #01579b)";
    } else if (weatherMain?.includes("snow")) {
        document.body.style.backgroundImage = "linear-gradient(160deg, #e0f7fa, #b0bec5)";
        wrapper.style.backgroundImage = "linear-gradient(160deg, #e0f7fa, #b0bec5)";
    }
}
    
        function renderForecast(forecastData) {
            forecastContainer.innerHTML = "";
            forecastContainer.classList.add("active");
            forecastData.list.slice(0, 5).forEach(item => {
                const date = new Date(item.dt * 1000);
                const card = document.createElement("div");
                card.classList.add("forecast-card");
                card.innerHTML = `
                    <p>${date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</p>
                    <img src="http://openweathermap.org/img/wn/${item.weather[0].icon}.png">
                    <p>${item.main.temp} °C</p>
                    <p>${item.weather[0].description}</p>
                `;
                forecastContainer.appendChild(card);
            });
        }

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition, (error) => {
                    errorMessage.textContent = "Location permission denied. Please allow access or use search.";
                    errorMessage.classList.add("active");
                    console.error("Geolocation error:", error);
                });
            } else {
                errorMessage.textContent = "Geolocation is not supported by your browser.";
                errorMessage.classList.add("active");
            }
        }

        function showPosition(position) {
            const userCoordinates = {
                lat: position.coords.latitude,
                lon: position.coords.longitude,
            };
            sessionStorage.setItem("user-coordinates", JSON.stringify(userCoordinates));
            fetchUserWeatherInfo(userCoordinates);
        }

        const grantAccessButton = document.querySelector("[data-grantAccess]");
        grantAccessButton.addEventListener("click", getLocation);

        const searchInput = document.querySelector("[data-searchInput]");
        searchForm.addEventListener("submit", (e) => {
            e.preventDefault();
            const cityName = searchInput.value.trim();
            if (cityName) {
                console.log("Searching for:", cityName);
                fetchSearchWeatherInfo(cityName);
            } else {
                errorMessage.textContent = "Please enter a city name.";
                errorMessage.classList.add("active");
            }
        });
    </script>
</body>
</html>